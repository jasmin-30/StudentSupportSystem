{% extends 'Base/base.html' %}
{% load static %}
<!-- Title block > Start -->
{% block title %}
    Detailed Feedback
{% endblock title %}
<!-- Title block > End -->

<!-- Extra CSS Block > Start -->
{% block extra_css %}
    <!-- ico font -->
    <link rel="stylesheet" type="text/css" href="{% static 'assets/icon/icofont/css/icofont.css' %}">
    <!-- Font Awesome -->
    <link rel="stylesheet" type="text/css" href="{% static 'assets/icon/font-awesome/css/font-awesome.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/star_ratings/display_rating.css' %}">
    <!-- sweet alert framework -->
    <link rel="stylesheet" type="text/css" href="{% static 'bower_components/sweetalert/css/sweetalert.css' %}">
{% endblock extra_css %}
<!-- Extra CSS Block > End -->

<!-- Custom CSS Block > Start -->
{% block custom_css %}
    <style type="text/css">
        li.disabled {
            pointer-events: none;
        }
        td {
            white-space: normal;
        }
    </style>
{% endblock custom_css %}
<!-- Custom CSS Block > End -->

<!-- Modals Block > Start -->
{% block modals %}
    <!-- Download Report > Start -->
    <div class="modal fade" id="download-report-modal" tabindex="-1" role="dialog" style="z-index: 1050; display: none;" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Download Report</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form method="post" action="{% url 'principal_download_detailed_report' %}">
                        {% csrf_token %}
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label" for="type" style="font-weight: 900;">Select Type of Feedback : </label>
                            <div class="col-sm-8">
                                <select class="custom-select" name="type" id="type" style="width: 100%" required>
                                    <option value="-1" selected disabled>Select Type</option>
                                    <option value="0">Mid Semester Feedback</option>
                                    <option value="1">End Semester Feedback</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label" for="term" style="font-weight: 900;">Term : </label>
                            <div class="col-sm-4">
                                <select class="custom-select" name="term" id="term" style="width: 100%" required>
                                    <option value="-1" selected disabled>Select Term</option>
                                    <option value="0">Odd</option>
                                    <option value="1">Even</option>
                                </select>
                                <div id="Error_term" style="color: red"></div>
                            </div>

                            <label class="col-sm-2 col-form-label" for="year" style="font-weight: 900;">Year : </label>
                            <div class="col-sm-4">
                                <select class="custom-select" name="year" id="year" style="width: 100%" required>
                                    <option value="-1" selected disabled>Select Year</option>
                                    <script type="text/javascript">
                                        var start_year = 2020;
                                        var current_year = new Date().getFullYear();
                                        for(var i=start_year;i<=current_year;++i) {
                                            document.write('<option value="'+ i +'">'+ i +'</option>');
                                        }
                                    </script>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label" for="faculty" style="font-weight: 900;">Faculty : </label>
                            <div class="col-sm-4">
                                <select class="custom-select" name="faculty" id="faculty" style="width: 100%" required>
                                   <option value="-1" selected disabled>Select Faculty</option>
                               {% for f in dept_faculties %}
                                   <option value="{{ f.id }}">{{ f.name }}</option>
                               {% endfor %}
                               </select>
                                <div id="Error_faculty" style="color: red"></div>
                            </div>
                            <label class="col-sm-2 col-form-label" for="subject" style="font-weight: 900;">Subject : </label>
                                <div class="col-sm-4">
                                    <select name="subject" id="subject" class="custom-select" style="width: 100%" required>
                                        <option value="-1" disabled selected>Select Subject</option>
                                    </select>
                                </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-12 d-flex justify-content-center">
                                <button type="submit" class="btn btn-outline-primary">
                                    <i class="feather icon-check"></i>  Download
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Download Report > End -->
{% endblock modals %}
<!-- Modals Block > End -->

<!-- Logo Block > Start -->
{% block logo %}
    <a href="{% url 'principal_dashboard' %}">
        <img class="img-fluid" src="{% static 'assets/images/logo.png' %}" alt="Student Support System">
    </a>
{% endblock logo %}
<!-- Logo Block > End -->

<!-- Navbar Right menus block > Start -->
{# everything inside <ul class="nav-right"> #}
{% block nav_right %}
    <ul class="nav-right">
        <li class="user-profile header-notification">
            <div class="dropdown-primary dropdown">
                <div class="dropdown-toggle" data-toggle="dropdown">
                    <span>{{ name }}</span>
                    <i class="feather icon-chevron-down"></i>
                </div>
                <ul class="show-notification profile-notification dropdown-menu" data-dropdown-in="fadeIn" data-dropdown-out="fadeOut">
                    <li>
                        <a href="{% url 'principal_profile' %}">
                            <i class="feather icon-user"></i> Profile
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'logout' %}">
                            <i class="feather icon-log-out"></i> Logout
                        </a>
                    </li>
                </ul>
            </div>
        </li>
    </ul>
{% endblock nav_right %}
<!-- Navbar Right menus block > End -->

<!-- Side Navigation bar Block > Start -->
{% block side_bar %}
{% endblock side_bar %}
<!-- Side Navigation bar Block > End -->


<!-- Main body block > Start -->
{# for dashboard, everything in this tag - <div class="pcoded-content"> #}
{# for others everything in this tag - <div class="pcoded-inner-content"> #}
{% block main_body %}
    <div class="pcoded-inner-content">
        <div class="main-body">
            <div class="page-wrapper">
                <div class="page-header">
                    <div class="row align-items-end">
                        <div class="col-sm-12 col-md-12 col-lg-6 d-flex justify-content-center">
                            <div class="page-header-title">
                                <div class="d-inline">
                                    <h3>{{ dept_name }} Department</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-12 col-lg-6 d-flex justify-content-center">
                            <div class="page-header-title">
                                <div class="d-inline">
                                    <h3>Detailed Feedback</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-8 col-md-8 col-lg-8 m-t-20">
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#download-report-modal">Download Report</button>
                        </div>
                        <div class="col-sm-4 d-flex justify-content-end">
                            <a class="btn btn-round btn-outline-primary" href="{% url 'principal_dashboard' %}">
                                <i class="feather icon-arrow-left"></i>
                                Back to Dashboard
                            </a>
                        </div>
                    </div>
                </div>
                <div class="page-body">
                    <div class="row">
                        <div class="col-sm-12">
                            <!-- Basic Form Inputs card start -->
                            <div class="card">
                                <div class="card-block">
                                    <div id="feedback_parameters" style="display: block">
                                        <form id="feedback_parameters_form">
                                            <div class="form-group row">
                                                <label class="col-md-2 col-lg-2 col-form-label" for="view_feedback_type" style="font-weight: 900;">Type of feedback : </label>
                                                <div class="col-md-2 col-lg-2">
                                                    <select class="custom-select" id="view_feedback_type" style="width: 100%" name="view_feedback_type">
                                                        <option value="-1" selected disabled>Type</option>
                                                        <option value="0">Mid Semester Feedback</option>
                                                        <option value="1">End Semester Feedback</option>
                                                    </select>
                                                    <div id="Error_view_feedback_type" style="color: red"></div>
                                                </div>
                                                <label class="col-md-2 col-lg-2 col-form-label" for="view_feedback_term" style="font-weight: 900;">Select Term : </label>
                                                <div class="col-md-2 col-lg-2">
                                                    <select class="custom-select" id="view_feedback_term" style="width: 100%" name="view_feedback_term">
                                                        <option value="-1" selected disabled>Select Term</option>
                                                        <option value="0">Odd</option>
                                                        <option value="1">Even</option>
                                                    </select>
                                                    <div id="Error_view_feedback_term" style="color: red"></div>
                                                </div>
                                                <label class="col-md-2 col-lg-2 col-form-label" for="view_feedback_year" style="font-weight: 900;">Select Year : </label>
                                                <div class="col-md-2 col-lg-2">
                                                    <select class="custom-select" id="view_feedback_year" style="width: 100%" name="view_feedback_year">
                                                        <option value="-1" selected disabled>Select Year</option>
                                                        <script type="text/javascript">
                                                            var start_year = 2020;
                                                            var current_year = new Date().getFullYear();
                                                            for(var i=start_year;i<=current_year;++i) {
                                                                document.write('<option value="'+ i +'">'+ i +'</option>');
                                                            }
                                                        </script>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <label class="col-md-2 col-lg-2 col-form-label" for="view_feedback_faculty" style="font-weight: 900;">Select Faculty : </label>
                                                <div class="col-md-4 col-lg-4">
                                                    <select class="custom-select" id="view_feedback_faculty" name="view_feedback_faculty" style="width: 100%">
                                                        <option value="-1" selected disabled>Select Faculty</option>
                                                        {% for f in dept_faculties %}
                                                            <option value="{{ f.id }}">{{ f.name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                    <div id="Error_view_feedback_faculty" style="color: red"></div>
                                                </div>
                                                <label class="col-md-2 col-lg-2 col-form-label" for="view_feedback_subject" style="font-weight: 900;">Select Subject : </label>
                                                <div class="col-md-4 col-lg-4">
                                                    <select class="custom-select" id="view_feedback_subject" name="view_feedback_subject" style="width: 100%" data-toggle="tooltip" data-placement="left" title="Subject list will be displayed dynamically according to the faculty and term you have chosen.">
                                                        <option value="-1">Select Subject</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-sm-2">
                                                    <button type="button" class="btn btn-outline-primary" onclick="load_feedback()">View Feedback</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="row" id="parameters_selected" style="display:none;">
                                        <div class="col-sm-10 d-flex justify-content-center"><h5 id="parameter_type"></h5></div>
                                        <div class="col-sm-2 d-flex justify-content-end"><a href="#" style="color: dodgerblue; font-size: inherit" id="modify_parameters">Modify Parameters</a></div>
                                        <label class="col-sm-2 col-form-label" style="font-weight: 900;">Term : </label>
                                        <label class="col-sm-4 col-form-label" id="parameter_term"></label>
                                        <label class="col-md-2 col-form-label" style="font-weight: 900;">Faculty : </label>
                                        <label class="col-md-4 col-form-label" id="parameter_faculty"></label>
                                        <label class="col-md-2 col-form-label" style="font-weight: 900;">Subject : </label>
                                        <label class="col-md-4 col-form-label" id="parameter_subject"></label>
                                        <label class="col-md-2 col-form-label" style="font-weight: 900;">Semester : </label>
                                        <label class="col-md-4 col-form-label" id="parameter_semester"></label>
                                    </div>
                                    <div class="loader-block" style="display: none">
                                        <svg id="loader2" viewBox="0 0 100 100">
                                            <circle id="circle-loader2" cx="50" cy="50" r="45"></circle>
                                        </svg>
                                    </div>
                                    <div id="feedback_content" style="display: none">
                                        <nav class="p-20" aria-label="Page navigation example">
                                            <ul class="pagination d-flex justify-content-center">
                                            </ul>
                                        </nav>
                                        <div class="row p-b-10">
                                            <div class="col-sm-6">Feedback Given Date: <b id="view_feedback_date"></b> </div>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-hover table-bordered">
                                                <thead>
                                                <tr>
                                                    <th style="width: 10%;">#</th>
                                                    <th style="width: 70%">Questions</th>
                                                    <th style="width: 20%">Feedback</th>
                                                </tr>
                                                </thead>
                                                <tbody id="table_body">
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-md-2 col-lg-2 col-form-label p-l-50" for="view_feedback_remarks"><b>Remarks : </b></label>
                                            <div class="col-sm-10">
                                                <textarea class="form-control" id="view_feedback_remarks" name="view_feedback_remarks" rows="3" readonly></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock main_body %}
<!-- Main body block > End -->

<!-- Extra JS Block > Start -->
{% block extra_js %}
    <!-- sweet alert js -->
    <script type="text/javascript" src="{% static 'bower_components/sweetalert/js/sweetalert.min.js' %}"></script>
{% endblock extra_js %}
<!-- Extra JS Block > End -->

<!-- Custom JS Block > Start -->
{% block custom_js %}
    <script>
        var fb_type;
        var subjects_dict = JSON.parse('{{ fac_subjects|safe }}');
        var feedback_list;
        console.log(subjects_dict);
        var questions_list = JSON.parse('{{ question_list|safe }}');
        console.log(questions_list);

        $(document).ready(function(){
            $('[data-toggle="tooltip"]').tooltip();

            // for changing table dynamically.
            var table_body = $(document).find('#table_body');
            $(document).on('change', 'select#view_feedback_type', function (event) {
                event.preventDefault();
                table_body.html();
                var type = $(this).val();
                if(type == "0") {
                    fb_type = 'mid';
                    var html = '';
                    $.each(questions_list['mid'], function (index, value) {
                        html += '<tr>';
                        html += '<th scope="row">'+ index +'</th>';
                        html += '<td>'+ value["question_text"] +'</td>';
                        html += '<td><div class="ans"></div></td>';
                        html += '</tr>';
                    });
                }
                else {
                    fb_type = 'end';
                    var html = '';
                    $.each(questions_list['end'], function (index, value) {
                        html += '<tr>';
                        html += '<th scope="row">'+ index +'</th>';
                        html += '<td>'+ value["question_text"] +'</td>';
                        html += '<td><div class="ans"></div></td>';
                        html += '</tr>';
                    });
                }
                table_body.html(html);
            });
        });
    </script>

    <script type="text/javascript">
        // for modify search click
        $(document).on('click', '#modify_parameters', function (event) {
            event.preventDefault();
            $(document).find('div#feedback_parameters').show();
            $(document).find('div#feedback_content').hide();
            $(document).find('div#parameters_selected').hide();
            document.getElementById('feedback_parameters_form').reset();
        });

        // Before selecting Subject it check whether faculty and term has been selected or not.
        function check_term() {
            var term = $(document).find('select#view_feedback_term option:selected').val();
            var faculty = $(document).find('select#view_feedback_faculty option:selected').val();
            var error = $(document).find('div#Error_view_feedback_term');
            if(term == "-1") {
                $(document).find('select#view_feedback_term').addClass('form-control-danger');
                error.css('display', 'block');
                error.html('Select Term');
            }
            else {
                $(document).find('select#view_feedback_term').removeClass('form-control-danger');
                error.css('display', 'none');
            }

            if(faculty == "-1") {
                $(document).find('select#view_feedback_faculty').addClass('form-control-danger');
                $(document).find('div#Error_view_feedback_faculty')
                    .css('display', 'block')
                    .html('Select Faculty');
            }
            else {
                $(document).find('select#view_feedback_faculty').removeClass('form-control-danger');
                $(document).find('div#Error_view_feedback_faculty').css('display', 'none')
            }
        }

        // To load subjects dynamically according to faculty and term chosen.
        function update_subjects() {
            check_term();
            var fac_id = $(document).find('select#view_feedback_faculty option:selected').val();
            var term = $(document).find('select#view_feedback_term option:selected').val();
            var sub_html = '<option value="-1" selected disabled>Select Subject</option>';
            if(term == "0") {
                $.each(subjects_dict[fac_id], function (index, value) {
                    if(value['subject_semester'] % 2) {
                        sub_html += '<option value="'+ value['subject_id'] +'" sem="'+ value['subject_semester'] +'">'+ value['subject_name'] + ' (' + value['subject_code'] + ')' + '</option>';
                    }
                });
            }
            else {
                $.each(subjects_dict[fac_id], function (index, value) {
                    if(!(value['subject_semester'] % 2)) {
                        sub_html += '<option value="'+ value['subject_id'] +'" sem="'+ value['subject_semester'] +'">'+ value['subject_name'] + ' (' + value['subject_code'] + ')' + '</option>';
                    }
                });
            }
            $(document).find('select#view_feedback_subject').html(sub_html);
        }

        $(document).on('change', 'select#view_feedback_faculty', function () {
            update_subjects();
        });

        $(document).on('change', 'select#view_feedback_term', function () {
            update_subjects();
        });

        // This function is for designing pagination for the first time.
        function design_pagination(total) {
            var pages = '';
            pages += '<li class="page-item" btn_type="prev" current_step="1" data-toggle="tooltip" title="Previous">';
                pages += '<a class="page-link" href="#">Previous</a>';
            pages += '</li>';
            if(total <= 11) {
                for(var i=1;i<=total;++i) {
                    pages += '<li class="page-item step-'+ i +'" step="'+ i +'"><a class="page-link" href="#">'+ i +'</a></li>';
                }
            }
            else {
                for(var i=1;i<=5;++i) {
                    pages += '<li class="page-item step-'+ i +'" step="'+ i +'"><a class="page-link" href="#">'+ i +'</a></li>';
                }
                pages += '<li class="page-item disabled"><a class="page-link" href="#">...</a></li>';
                pages += '<li class="page-item step-'+ (total-1) +'" step="'+ (total-1) +'"><a class="page-link" href="#">'+ (total-1) +'</a></li>';
                pages += '<li class="page-item step-'+ (total) +'" step="'+ (total) +'"><a class="page-link" href="#">'+ (total) +'</a></li>';

            }
            pages += '<li class="page-item" btn_type="next" current_step="1" data-toggle="tooltip" title="Next">';
                pages += '<a class="page-link" href="#">Next</a>';
            pages += '</li>';

            $(document).find('ul.pagination').html(pages);
            $(document).find('ul.pagination li:first-child').addClass('disabled');
            Show_feedback(1);
        }

        // This function is to display feedbacks.
        function Show_feedback(page_no) {
            var previous_li = $(document).find('ul.pagination li:first-child');
            var last_li = $(document).find('ul.pagination li:last-child');
            if(page_no > 1) {
                previous_li.removeClass('disabled');
            }
            else {
                previous_li.addClass('disabled');
            }

            if(page_no == feedback_list.length) {
                last_li.addClass('disabled');
            }
            else {
                last_li.removeClass('disabled');
            }

            $(document).find('div.ans').each(function (index, value) {
                var ans = feedback_list[page_no-1]['q' + (index+1)];
                var content = '<div class="rating-'+ans+'">';
                var i;
                for(i=1;i<=parseInt(ans);++i) {
                    content += '<label class="rating"></label>';
                }
                content += '</div>';
                $(this).html(content);
            });
            $(document).find('textarea#view_feedback_remarks').val(feedback_list[page_no-1]['remark']);
            $(document).find('b#view_feedback_date').html(feedback_list[page_no-1]['date']);
            $(document).find('ul.pagination li.step-'+ page_no +'').addClass('active');
        }

        // This is click event for pages in paginations
        $(document).on('click', 'li.page-item', function (event) {
            event.preventDefault();
            var page_no = parseInt($(this).attr('step')) || parseInt($(this).attr('current_step'));
            var btn = $(this).attr('btn_type') || null;
            if(btn == "prev") {
                page_no--;
            }
            else if(btn == "next") {
                page_no++;
            }
            var total_page = feedback_list.length;
            var pages = '';
            pages += '<li class="page-item" btn_type="prev" current_step="'+ page_no +'" data-toggle="tooltip" title="Previous">';
                pages += '<a class="page-link" href="#">Previous</a>';
            pages += '</li>';
            if(total_page <= 11) {
                for(var i=1;i<=total_page;++i) {
                    pages += '<li class="page-item step-'+ i +'" step="'+ i +'"><a class="page-link" href="#">'+ i +'</a></li>';
                }
            }
            else {
                if(page_no > total_page-3) {
                    //1,2,gap,total-4,total-3,total-2,total-1,total
                    pages += '<li class="page-item step-'+ 1 +'" step="'+ 1 +'"><a class="page-link" href="#">'+ 1 +'</a></li>';
                    pages += '<li class="page-item step-'+ 2 +'" step="'+ 2 +'"><a class="page-link" href="#">'+ 2 +'</a></li>';
                    pages += '<li class="page-item disabled"><a class="page-link" href="#">...</a></li>';
                    for(var i=4;i>=0;--i) {
                        pages += '<li class="page-item step-'+ (total_page-i) +'" step="'+ (total_page-i) +'"><a class="page-link" href="#">'+ (total_page-i) +'</a></li>';
                    }
                }

                else if(page_no > total_page-5 && page_no <= total_page-3) {
                    //1,2,gap,pn-2,pn-1,pn upto total
                    pages += '<li class="page-item step-'+ 1 +'" step="'+ 1 +'"><a class="page-link" href="#">'+ 1 +'</a></li>';
                    pages += '<li class="page-item step-'+ 2 +'" step="'+ 2 +'"><a class="page-link" href="#">'+ 2 +'</a></li>';
                    pages += '<li class="page-item disabled"><a class="page-link" href="#">...</a></li>';
                    for(var i=(page_no-2);i<=total_page;++i) {
                        pages += '<li class="page-item step-'+ i +'" step="'+ i +'"><a class="page-link" href="#">'+ i +'</a></li>';
                    }
                }

                else if(page_no >= 6 && page_no <= total_page-5) {
                    //1,2,gap,pn-2,pn-1,pn,pn+1,pn+2,gap,total-1,total
                    pages += '<li class="page-item step-'+ 1 +'" step="'+ 1 +'"><a class="page-link" href="#">'+ 1 +'</a></li>';
                    pages += '<li class="page-item step-'+ 2 +'" step="'+ 2 +'"><a class="page-link" href="#">'+ 2 +'</a></li>';
                    pages += '<li class="page-item disabled"><a class="page-link" href="#">...</a></li>';
                    for(var i=(page_no-2);i<=(page_no+2);++i) {
                        pages += '<li class="page-item step-'+ i +'" step="'+ i +'"><a class="page-link" href="#">'+ i +'</a></li>';
                    }
                    pages += '<li class="page-item disabled"><a class="page-link" href="#">...</a></li>';
                    pages += '<li class="page-item step-'+ (total_page-1) +'" step="'+ (total_page-1) +'"><a class="page-link" href="#">'+ (total_page-1) +'</a></li>';
                    pages += '<li class="page-item step-'+ (total_page) +'" step="'+ (total_page) +'"><a class="page-link" href="#">'+ (total_page) +'</a></li>';
                }

                else if(page_no > 3 && page_no < 6) {
                    for(var i=1;i<=(page_no+2);++i) {
                        pages += '<li class="page-item step-'+ i +'" step="'+ i +'"><a class="page-link" href="#">'+ i +'</a></li>';
                    }
                    pages += '<li class="page-item disabled"><a class="page-link" href="#">...</a></li>';
                    pages += '<li class="page-item step-'+ (total_page-1) +'" step="'+ (total_page-1) +'"><a class="page-link" href="#">'+ (total_page-1) +'</a></li>';
                    pages += '<li class="page-item step-'+ (total_page) +'" step="'+ (total_page) +'"><a class="page-link" href="#">'+ (total_page) +'</a></li>';
                }
                else {
                    for(var i=1;i<=5;++i) {
                        pages += '<li class="page-item step-'+ i +'" step="'+ i +'"><a class="page-link" href="#">'+ i +'</a></li>';
                    }
                    pages += '<li class="page-item disabled"><a class="page-link" href="#">...</a></li>';
                    pages += '<li class="page-item step-'+ (total_page-1) +'" step="'+ (total_page-1) +'"><a class="page-link" href="#">'+ (total_page-1) +'</a></li>';
                    pages += '<li class="page-item step-'+ (total_page) +'" step="'+ (total_page) +'"><a class="page-link" href="#">'+ (total_page) +'</a></li>';
                }
            }
            pages += '<li class="page-item" btn_type="next" current_step="'+ page_no +'" data-toggle="tooltip" title="Next">';
                pages += '<a class="page-link" href="#">Next</a>';
            pages += '</li>';
            $(document).find('ul.pagination').html(pages);
            Show_feedback(page_no);
        });

        // this is the function to load feedback from server to display all the feedback.
        function load_feedback() {
            var faculty_select_tag = $(document).find('select#view_feedback_faculty option:selected');
            var subject_select_tag = $(document).find('select#view_feedback_subject option:selected');
            var term_select_tag = $(document).find('select#view_feedback_term option:selected');
            var year_select_tag = $(document).find('select#view_feedback_year option:selected');
            var type_select_tag = $(document).find('select#view_feedback_type option:selected');
            // filling parameters_selected div
            $(document).find('#parameter_type').html(type_select_tag.text());
            $(document).find('label#parameter_term').html(term_select_tag.text() +" "+ year_select_tag.text());
            $(document).find('label#parameter_faculty').html(faculty_select_tag.text());
            $(document).find('label#parameter_subject').html(subject_select_tag.text());
            $(document).find('label#parameter_semester').html(subject_select_tag.attr('sem'));

            feedback_list = [];
            var faculty_id = faculty_select_tag.val();
            var subject_id = subject_select_tag.val();
            var term = term_select_tag.val();
            var type = type_select_tag.val();
            var year = year_select_tag.val();
            if(faculty_id == "-1" || subject_id == "-1" || term == "-1" || year == "-1" || type == "-1") {
                alert('All the fields are required.');
            }
            else {
                $(document).find('.loader-block').css('display','block');
                $(document).find('#feedback_content').css('display','none');
                $(document).find('div#feedback_parameters').css('display', 'none');
                $.ajax({
                    type: "GET",
                    url: "{{ base_url }}" + "get-all-feedback/",
                    data: {
                        type: fb_type,
                        fac_id: faculty_id,
                        sub_id: subject_id,
                        term: term,
                        year: year
                    },

                    success: function (msg) {
                        var response = JSON.parse(msg);
                        console.log(response);
                        $(document).find('.loader-block').css('display','none');
                        $(document).find('div#feedback_parameters').css('display', 'none');
                        $(document).find('#feedback_content').css('display','block');
                        $(document).find('#parameters_selected').show();
                        feedback_list = response['feedback_list'];
                        var len = feedback_list.length;
                        if(len<1) {
                            $(document).find('#parameters_selected').hide();
                            $(document).find('#feedback_content').css('display','none');
                            $(document).find('div#feedback_parameters').css('display', 'block');
                            swal({
                                title: "Error",
                                text: "No Feedback available. Please check selected values again.",
                                dangerMode: true,
                                type: "error",
                            });
                        }
                        else {
                            design_pagination(len);
                        }
                    },
                    error: function (msg) {
                        var response = JSON.parse(msg.responseText);
                        console.log(response);
                        swal({
                            title: "Error",
                            text: response['error'],
                            dangerMode: true,
                            type: "error",
                        });
                        $(document).find('div#feedback_parameters').css('display', 'block');
                        $(document).find('#parameters_selected').hide();
                    },
                });
            }
        }
    </script>

    <script type="text/javascript">

        function check_modal_data() {
            var term = $(document).find('select#term option:selected').val();
            var faculty = $(document).find('select#faculty option:selected').val();
            var error = $(document).find('div#Error_term');
            if(term == "-1") {
                $(document).find('select#term').addClass('form-control-danger');
                error.css('display', 'block');
                error.html('Select Term');
            }
            else {
                $(document).find('select#term').removeClass('form-control-danger');
                error.css('display', 'none');
            }

            if(faculty == "-1") {
                $(document).find('select#faculty').addClass('form-control-danger');
                $(document).find('div#Error_faculty')
                    .css('display', 'block')
                    .html('Select Faculty');
            }
            else {
                $(document).find('select#faculty').removeClass('form-control-danger');
                $(document).find('div#Error_faculty').css('display', 'none')
            }
        }

        function load_faculty_modal() {
            check_modal_data();
            var term = $(document).find('select#term').val();
            var fac_id = $(document).find('select#faculty').val();
            var sub_html = '<option value="-1" selected disabled>Select Subject</option>';
            if(term == "0") {
                $.each(subjects_dict[fac_id], function (index, value) {
                    if(value['subject_semester'] % 2) {
                        sub_html += '<option value="'+ value['subject_id'] +'" sem="'+ value['subject_semester'] +'">'+ value['subject_name'] + ' (' + value['subject_code'] + ')' + '</option>';
                    }
                });
            }
            else {
                $.each(subjects_dict[fac_id], function (index, value) {
                    if(!(value['subject_semester'] % 2)) {
                        sub_html += '<option value="'+ value['subject_id'] +'" sem="'+ value['subject_semester'] +'">'+ value['subject_name'] + ' (' + value['subject_code'] + ')' + '</option>';
                    }
                });
            }
            $(document).find('select#subject').html(sub_html);
        }

        $(document).on('change', 'select#faculty', load_faculty_modal);
        $(document).on('change', 'select#term', load_faculty_modal);
    </script>
{% endblock custom_js %}
<!-- Custom JS Block > End -->